<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ø£Ø´Ø·Ø± Ø¨Ù†ÙˆØªÙ‡ Ù Ø§Ù„Ø¯Ù†ÙŠØ§ â¤ï¸ â€” Ù„ÙŠÙ†Ø§ Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg-top:#e8f7ff;
    --bg-bottom:#ffffff;
    --primary:#2563eb;
    --accent:#3b82f6;
    --muted:#64748b;
    --success:#16a34a;
    --danger:#ef4444;
    --card-bg: rgba(255,255,255,0.98);
    --text:#0f172a;
  }
  *{box-sizing:border-box;margin:0;padding:0;font-family:"Cairo",sans-serif}
  body,html{height:100%;background:linear-gradient(180deg,var(--bg-top),var(--bg-bottom));color:var(--text);}
  .stage{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:16px}
  .card{width:100%;max-width:480px;background:var(--card-bg);border-radius:18px;padding:20px;text-align:center;box-shadow:0 20px 40px rgba(15,23,42,0.08);position:relative;overflow:hidden;}
  h1.title{margin:6px 0 10px;font-size:28px;color:var(--primary);font-weight:700}
  .divider{height:5px;width:120px;margin:10px auto;border-radius:6px;background:linear-gradient(90deg,#60a5fa,#34d399)}
  .hearts{display:flex;gap:8px;justify-content:center;margin-bottom:6px}
  .hearts span{font-size:18px;color:rgba(59,130,246,0.6)}
  .icon-book{font-size:36px;color:#34d399;margin-bottom:10px}
  .subtitle{margin:0 0 14px;color:rgba(15,23,42,0.6);font-size:14px}
  .controls{display:flex;flex-direction:column;gap:10px;align-items:center;justify-content:center;margin-bottom:14px}
  .primary-btn{width:90%;max-width:360px;padding:12px 16px;border-radius:12px;border:none;background:linear-gradient(90deg,var(--accent),#06b6d4);color:white;font-size:16px;font-weight:800;cursor:pointer;box-shadow:0 10px 28px rgba(59,130,246,0.16);transition:transform .14s ease,box-shadow .14s ease;}
  .primary-btn:hover{transform:translateY(-2px);box-shadow:0 16px 40px rgba(59,130,246,0.22)}
  .file-btn{width:90%;max-width:360px;padding:10px;border-radius:12px;border:1px solid rgba(37,99,235,0.12);background:transparent;color:var(--text);font-weight:700;cursor:pointer;font-size:14px}
  .modes{display:flex;gap:12px;justify-content:center;margin-top:12px;flex-wrap:wrap;display:none}
  .mode-card{flex:1 1 200px;max-width:240px;background:rgba(255,255,255,0.96);border-radius:12px;padding:16px;box-shadow:0 6px 20px rgba(2,6,23,0.04);text-align:center;}
  .mode-icon{width:48px;height:48px;border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 10px;font-size:24px}
  .mc .mode-icon{background:rgba(59,130,246,0.12);color:var(--accent)}
  .type .mode-icon{background:rgba(16,185,129,0.08);color:#10b981}
  .mode-title{font-weight:800;font-size:18px;margin-bottom:6px}
  .mode-desc{color:var(--muted);margin-bottom:10px;font-size:13px}
  .mode-start{padding:8px 12px;border-radius:10px;border:none;background:linear-gradient(90deg,var(--accent),#06b6d4);color:white;font-weight:800;cursor:pointer;font-size:14px}
  .quiz{display:none;margin-top:14px}
  #progressBarContainer{width:100%;background:#eef2ff;height:28px;border-radius:999px;overflow:hidden;position:relative;margin-bottom:10px}
  #progressBar{height:100%;width:0%;background:linear-gradient(90deg,var(--accent),#60a5fa);transition:width .45s ease}
  #progressText{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-weight:800;color:white;font-size:12px;text-shadow:0 1px 2px rgba(0,0,0,0.25)}
  #question{font-size:16px;margin:12px 0;padding:10px;border-radius:10px;background:rgba(2,6,23,0.03);min-height:56px;display:flex;align-items:center;justify-content:center;gap:8px}
  .speak-btn{background:transparent;border:none;font-size:16px;cursor:pointer;color:var(--primary)}
  .options{display:flex;flex-direction:column;gap:10px;align-items:center;margin-bottom:10px}
  .option{width:90%;max-width:360px;padding:10px 12px;border-radius:12px;background:var(--accent);color:white;font-weight:700;cursor:pointer;transition:transform .12s;box-shadow:0 8px 24px rgba(59,130,246,0.12)}
  .option:hover{transform:translateY(-2px)}
  .option.correct{background:var(--success)!important}
  .option.wrong{background:var(--danger)!important}
  .type-input{width:80%;max-width:360px;padding:10px;border-radius:10px;border:2px solid rgba(37,99,235,0.12);text-align:center;font-weight:700;font-size:14px;margin-bottom:10px}
  #feedback{margin-top:8px;font-weight:800;min-height:24px;font-size:14px;text-align:center}
  .review{display:none;margin-top:12px}
  .review-list{max-height:300px;overflow:auto;margin:12px auto;width:92%;text-align:right}
  .review-item{display:flex;justify-content:space-between;align-items:center;background:#f0f9f1;color:var(--success);font-size:16px;font-weight:900;padding:10px 12px;border-radius:10px;margin:6px 0}
  .review-item .mean{color:var(--text);font-size:14px;font-weight:700;opacity:0.95;margin-left:6px}
  .play-icon{background:transparent;border:none;font-size:16px;color:var(--primary);cursor:pointer;margin-left:6px}
  .review-controls{display:flex;gap:8px;justify-content:center;margin-top:10px}
  .btn-ghost{padding:8px 12px;border-radius:10px;border:1px solid rgba(37,99,235,0.12);background:transparent;cursor:pointer;font-weight:700}
  .btn-home{padding:10px 14px;border-radius:12px;border:none;background:#64748b;color:white;font-weight:800;cursor:pointer}
  .final-msg{display:none;margin-top:12px;font-size:18px;color:var(--primary);font-weight:900}
  .note{margin-top:10px;color:rgba(15,23,42,0.6);font-size:12px;text-align:center}
</style>
</head>
<body>
<div class="stage">
<main class="card" role="main" aria-labelledby="main-title">

  <div class="hearts" id="hearts"><span>â¤</span><span>â¤</span><span style="opacity:0.7">â¤</span></div>
  <h1 id="main-title" class="title">Ø£Ø´Ø·Ø± Ø¨Ù†ÙˆØªÙ‡ Ù Ø§Ù„Ø¯Ù†ÙŠØ§ â¤ï¸</h1>
  <div class="divider" id="divider" aria-hidden="true"></div>
  <div class="icon-book" id="icon-book">ğŸ“˜</div>
  <p class="subtitle" id="subtitle">Ready to learn some English?</p>

  <div class="controls" id="homeControls">
    <button id="startBtn" class="primary-btn">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
    <label class="file-btn" for="fileInput">Ø±ÙØ¹ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø®Ø§ØµØ© ğŸ“
      <input id="fileInput" type="file" accept=".txt" style="display:none">
    </label>
  </div>

  <section class="modes" id="modesSection">
    <div class="mode-card mc">
      <div class="mode-icon">âœ“</div>
      <div class="mode-title">Multiple Choice</div>
      <div class="mode-desc">See an English word and choose the correct Arabic meaning from 4 options</div>
      <button class="mode-start" id="startMC">Ø§Ø¨Ø¯Ø¦ÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª ğŸ¯</button>
    </div>
    <div class="mode-card type">
      <div class="mode-icon">âœï¸</div>
      <div class="mode-title">Type the Word</div>
      <div class="mode-desc">See the Arabic meaning and type the correct English word</div>
      <button class="mode-start" id="startType">Ø§Ø¨Ø¯Ø¦ÙŠ ÙˆØ¶Ø¹ Ø§Ù„ÙƒØªØ§Ø¨Ø© âœï¸</button>
    </div>
  </section>

  <section class="quiz" id="quizBlock">
    <div id="progressBarContainer">
      <div id="progressBar"></div>
      <div id="progressText">0/0 Ø³Ø¤Ø§Ù„</div>
    </div>
    <div id="question"><span id="questionText"></span>
      <button id="speakQuestion" class="speak-btn">ğŸ”Š</button>
    </div>
    <div class="options" id="options"></div>
    <div id="typeArea" style="display:none">
      <input id="typeInput" class="type-input" placeholder="Ø§ÙƒØªØ¨ÙŠ Ø§Ù„ÙƒÙ„Ù…Ø© Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ Ø«Ù… Ø§Ø¶ØºØ·ÙŠ Enter">
    </div>
    <div id="feedback"></div>
    <div class="flex-row">
      <button id="homeBtnFixed" class="btn-home">ğŸ  Ø±Ø¬ÙˆØ¹ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    </div>
  </section>

  <section class="review" id="reviewBlock">
    <h3>Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù„ÙŠ ØºÙ„Ø·ØªÙŠ ÙÙŠÙ‡Ø§ ğŸ“˜</h3>
    <div class="review-list" id="reviewList"></div>
    <div class="review-controls">
      <button id="retryBtn" class="primary-btn">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„ØºÙ„Ø·</button>
      <button id="homeBtn" class="btn-home">Ø±Ø¬ÙˆØ¹ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    </div>
    <div class="final-msg" id="finalMsg">ÙˆØ§Ø§Ø§Ø§Ø§Ø§Ø§Ø§Ùˆ ğŸ˜ Ø´Ø·ÙˆØ±Ø© Ø£ÙˆÙŠ â¤ï¸</div>
  </section>

  <p class="note">Ø§Ø±ÙØ¹ Ù…Ù„Ù .txt Ø¨ØµÙŠØºØ©: <em>book=ÙƒØªØ§Ø¨</em> Ø£Ùˆ <em>book ÙƒØªØ§Ø¨</em> Ø£Ùˆ <em>book-ÙƒØªØ§Ø¨</em></p>

</main>
</div>

<script>
/* ========= JS Ù…Ø®ØªØµØ± + Ù†Ù‡Ø§Ø¦ÙŠ ========= */
let defaultWords=[{en:"duty",ar:"ÙˆØ§Ø¬Ø¨ - ÙˆØ¸ÙŠÙØ©"},{en:"emergency",ar:"Ø­Ø§Ù„Ø© Ø·ÙˆØ§Ø±Ø¦"},{en:"flood",ar:"ÙÙŠØ¶Ø§Ù†"}];
let originalWords=defaultWords.slice(), words=[], current=0, mistakes=[], mode=null;
const startBtn=document.getElementById('startBtn'), homeControls=document.getElementById('homeControls');
const modesSection=document.getElementById('modesSection'), startMC=document.getElementById('startMC'), startType=document.getElementById('startType');
const quizBlock=document.getElementById('quizBlock'), questionText=document.getElementById('questionText'), optionsEl=document.getElementById('options');
const typeArea=document.getElementById('typeArea'), typeInput=document.getElementById('typeInput'), feedbackEl=document.getElementById('feedback');
const progressBar=document.getElementById('progressBar'), progressText=document.getElementById('progressText'), reviewBlock=document.getElementById('reviewBlock'), reviewList=document.getElementById('reviewList');
const retryBtn=document.getElementById('retryBtn'), homeBtnFixed=document.getElementById('homeBtnFixed'), speakQuestionBtn=document.getElementById('speakQuestion');

function shuffle(a){for(let i=a.length-1;i>0;i--){let j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a;}
function showProgress(){let tot=Math.max(words.length,1),cur=Math.min(current+1,tot);progressText.innerText=cur+"/"+tot+" Ø³Ø¤Ø§Ù„";progressBar.style.width=Math.round((current/tot)*100)+'%';}
function speak(text,lang){if(!window.speechSynthesis)return;const u=new SpeechSynthesisUtterance(text);u.lang=lang==='en'?'en-US':'ar-SA';window.speechSynthesis.cancel();window.speechSynthesis.speak(u);}
function showQuestion(){if(current>=words.length){quizBlock.style.display='none';showReview();return;}showProgress();const q=words[current];if(mode==='mc'){questionText.innerText=q.en;let opts=[q.ar];while(opts.length<4){let pick=originalWords[Math.floor(Math.random()*originalWords.length)].ar;if(!opts.includes(pick))opts.push(pick);}opts=shuffle(opts);optionsEl.innerHTML='';opts.forEach(opt=>{let el=document.createElement('div');el.className='option';el.textContent=opt;el.onclick=()=>handleMCChoice(el,opt,q);optionsEl.appendChild(el);});typeArea.style.display='none';typeInput.value='';speak(q.en,'en');}else{questionText.innerText=q.ar;optionsEl.innerHTML='';typeArea.style.display='block';typeInput.value='';typeInput.focus();speak(q.ar,'ar');}}
function handleMCChoice(el,chosen,q){Array.from(optionsEl.children).forEach(o=>o.style.pointerEvents='none');if(chosen===q.ar){el.classList.add('correct');}else{el.classList.add('wrong');Array.from(optionsEl.children).forEach(o=>{if(o.textContent===q.ar)o.classList.add('correct')});mistakes.push(q);}setTimeout(()=>{current++;showQuestion();},900);}
typeInput.addEventListener('keydown',e=>{if(e.key==='Enter'){let val=typeInput.value.trim();if(val==='')return;handleTyping(val);}});function handleTyping(val){let q=words[current];if(val.toLowerCase()===q.en.toLowerCase()){feedbackEl.innerText='ØµØ­!';}else{feedbackEl.innerText='ØºÙ„Ø·!';mistakes.push(q);}current++;feedbackEl.innerText='';showQuestion();}
function showReview(){reviewBlock.style.display='block';let unique=[...new Map(mistakes.map(i=>[i.en,i])).values()];reviewList.innerHTML='';if(unique.length===0){reviewList.innerHTML='<div>Ù…Ø¨Ø±ÙˆÙƒ! Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø®Ø·Ø§Ø¡ ğŸ‘</div>';}else{unique.forEach(u=>{let div=document.createElement('div');div.className='review-item';div.innerHTML=`${u.en} â†’ ${u.ar}`;reviewList.appendChild(div);});}}
startBtn.onclick=()=>{homeControls.style.display='none';modesSection.style.display='flex';};
startMC.onclick=()=>{mode='mc';words=originalWords.slice();current=0;mistakes=[];quizBlock.style.display='block';modesSection.style.display='none';showQuestion();}
startType.onclick=()=>{mode='type';words=originalWords.slice();current=0;mistakes=[];quizBlock.style.display='block';modesSection.style.display='none';showQuestion();}
homeBtnFixed.onclick=()=>{quizBlock.style.display='none';reviewBlock.style.display='none';homeControls.style.display='flex';modesSection.style.display='none';feedbackEl.innerText='';current=0;words=[];mistakes=[];}
</script>
<!-- ====== Ø§Ù„Ø²Ø± Ø§Ù„Ø³Ø±ÙŠ Ù…Ù† Ø²ÙˆØ²Ùˆ ğŸ’Œ ====== -->
<style>
  #secretBtn {
    position: fixed;
    bottom: 22px;
    right: 22px;
    background: linear-gradient(135deg, #60a5fa, #a78bfa);
    color: white;
    font-weight: 800;
    border: none;
    border-radius: 50px;
    padding: 12px 18px;
    font-size: 14px;
    box-shadow: 0 8px 20px rgba(99,102,241,0.3);
    cursor: pointer;
    display: none;
    z-index: 9999;
    transition: all 0.4s ease;
  }
  #secretBtn:hover {
    transform: scale(1.08);
    box-shadow: 0 10px 28px rgba(59,130,246,0.4);
  }
  #lovePopup {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: linear-gradient(135deg, #ffffff, #e0e7ff);
    border: 2px solid #a78bfa;
    border-radius: 16px;
    box-shadow: 0 8px 40px rgba(37,99,235,0.25);
    padding: 25px;
    width: 280px;
    text-align: center;
    display: none;
    z-index: 10000;
  }
  #lovePopup h3 {
    color: #2563eb;
    font-size: 20px;
    margin-bottom: 10px;
  }
  #lovePopup p {
    color: #1e293b;
    font-size: 16px;
    font-weight: 700;
  }
  #closePopup {
    margin-top: 12px;
    background: linear-gradient(90deg, #6366f1, #3b82f6);
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 12px;
    cursor: pointer;
    font-weight: 800;
    transition: all 0.3s ease;
  }
  #closePopup:hover {
    transform: scale(1.05);
  }
</style>

<button id="secretBtn">ğŸ’Œ Ù…Ù† Ø²ÙˆØ²Ùˆ</button>

<div id="lovePopup">
  <h3>Ø±Ø³Ø§Ù„Ø© Ù…Ù† Ø²ÙˆØ²Ùˆ ğŸ’–</h3>
  <p id="loveText">Ø¨Ø­Ø¨ÙƒÙƒÙƒÙƒÙƒÙƒÙƒÙƒÙƒÙƒÙƒÙƒÙƒÙƒÙƒ ÙˆØ§Ù„Ù„Ù‡ ğŸ’–</p>
  <button id="closePopup">Ø¥ØºÙ„Ø§Ù‚</button>
</div>

<script>
  const secretBtn = document.getElementById('secretBtn');
  const lovePopup = document.getElementById('lovePopup');
  const loveText = document.getElementById('loveText');
  const closePopup = document.getElementById('closePopup');

  const loveMessages = [
    "Ø¨Ø­Ø¨ÙƒÙƒÙƒÙƒÙƒÙƒÙƒÙƒÙƒÙƒÙƒÙƒÙƒÙƒÙƒ ÙˆØ§Ù„Ù„Ù‡ ğŸ’–",
    "ÙŠØ®Ø±Ø§Ø§Ø§Ø§Ø§Ø§Ø´ÙŠ Ø´Ø·ÙˆÙˆÙˆÙˆÙˆÙˆØ±Ø© ğŸ˜",
    "Ù…Ø²Ø²Ø²Ù‡Ù‡ ÙˆØ´Ø§Ø·Ø±Ø© ğŸ’‹"
  ];

  function showSecretBtn() {
    secretBtn.style.display = 'block';
    setTimeout(() => { secretBtn.style.display = 'none'; }, 15000); // ÙŠØ¸Ù‡Ø± 15 Ø«Ø§Ù†ÙŠØ©
  }

  // ÙŠØ¸Ù‡Ø± Ø§Ù„Ø²Ø± Ø£ÙˆÙ„ Ù…Ø±Ø© Ø¨Ø¹Ø¯ Ø¯Ù‚ÙŠÙ‚Ø©ØŒ Ø«Ù… ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
  setInterval(showSecretBtn, 60000);
  setTimeout(showSecretBtn, 60000);

  secretBtn.addEventListener('click', () => {
    const randomMsg = loveMessages[Math.floor(Math.random() * loveMessages.length)];
    loveText.textContent = randomMsg;
    lovePopup.style.display = 'block';
    secretBtn.style.display = 'none';
  });

  closePopup.addEventListener('click', () => {
    lovePopup.style.display = 'none';
  });
</script>
</body>
</html>
<script>
/* ====== Stars & Confetti ====== */
const starsWrap=document.getElementById('starsWrap');
const starEls=[document.getElementById('star1'),document.getElementById('star2'),document.getElementById('star3'),document.getElementById('star4'),document.getElementById('star5')];
let correctCount=0, starsEarned=0;

function checkForStar(){
  let newStars=Math.floor(correctCount/5);
  if(newStars>starsEarned){
    let gained=newStars-starsEarned;
    starsEarned=newStars;
    for(let i=0;i<gained;i++){
      const idx=Math.min(starEls.length-1, starsEarned-1-i);
      if(starEls[idx]){ starEls[idx].style.opacity=1; starEls[idx].style.transform='scale(1.3)'; setTimeout(()=>starEls[idx].style.transform='scale(1)',300); }
    }
    spawnConfetti(60);
  }
}
function updateStars(){starEls.forEach((s,i)=>{s.style.opacity=i<starsEarned?1:0.25});}

/* ====== Confetti ====== */
const confettiCanvas=document.getElementById('confetti');
const ctx=confettiCanvas.getContext('2d');
let confettiParticles=[];
function spawnConfetti(num){
  const w=confettiCanvas.width=window.innerWidth;
  const h=confettiCanvas.height=window.innerHeight;
  for(let i=0;i<num;i++){
    confettiParticles.push({x:Math.random()*w,y:Math.random()*h,r:Math.random()*6+4,d:Math.random()*30,dx:(Math.random()*4-2),dy:(Math.random()*4+2),color:`hsl(${Math.random()*360},70%,50%)`});
  }
  requestAnimationFrame(updateConfetti);
}
function updateConfetti(){
  ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
  confettiParticles.forEach(p=>{ctx.fillStyle=p.color;ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,Math.PI*2);ctx.fill();p.x+=p.dx;p.y+=p.dy;if(p.y>confettiCanvas.height){p.y=0;p.x=Math.random()*confettiCanvas.width}});if(confettiParticles.length>0)requestAnimationFrame(updateConfetti);
}

/* ====== Secret Message ====== */
const secretMessage=document.getElementById('secretMessage');
const secretClose=document.getElementById('secretClose');
let keyBuffer='';
window.addEventListener('keydown',e=>{
  keyBuffer+=e.key.toLowerCase(); if(keyBuffer.length>10) keyBuffer=keyBuffer.slice(-10);
  if(keyBuffer.includes('moaz')||keyBuffer.includes('Ù…Ø¹Ø§Ø°')){
    secretMessage.style.display='block';
    setTimeout(()=>{secretMessage.style.display='none'},5000);
    keyBuffer='';
  }
});
secretClose.onclick=()=>{secretMessage.style.display='none'}

/* ====== File Upload & Save State ====== */
const localKey='lina_quiz_v1_state';
function saveState(){try{localStorage.setItem(localKey,JSON.stringify({originalWords,words,current,mistakes,mode,correctCount,starsEarned}));}catch(e){}}
function loadState(){try{let s=localStorage.getItem(localKey);if(!s)return null;return JSON.parse(s);}catch(e){return null}}
function clearState(){try{localStorage.removeItem(localKey);}catch(e){}}
fileInput.addEventListener('change',e=>{
  const f=e.target.files[0];if(!f)return;
  const reader=new FileReader();
  reader.onload=ev=>{
    const raw=ev.target.result;
    const lines=raw.split(/\r?\n/).map(l=>l.trim()).filter(Boolean);
    const parsed=lines.map(line=>{
      let sep=line.includes('=')?'=':(line.includes('-')?'-':' ');
      let parts=line.split(sep).map(p=>p.trim()).filter(Boolean);
      if(parts.length>=2)return {en:parts[0],ar:parts.slice(1).join(' ')};
      return null;
    }).filter(Boolean);
    if(parsed.length===0){alert('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ÙƒÙ„Ù…Ø§Øª ØµØ§Ù„Ø­Ø© ÙÙŠ Ø§Ù„Ù…Ù„Ù'); return;}
    originalWords=parsed;
    alert(`ØªÙ… ØªØ­Ù…ÙŠÙ„ ${originalWords.length} ÙƒÙ„Ù…Ø© âœ…`);
    saveState();
  };
  reader.readAsText(f,'UTF-8');
});

/* ====== Home Reset & Retry ====== */
homeBtnFixed.onclick=()=>{quizBlock.style.display='none';reviewBlock.style.display='none';homeControls.style.display='flex';modesSection.style.display='none';feedbackEl.innerText='';current=0;words=[];mistakes=[];correctCount=0;starsEarned=0;updateStars();clearState();}
retryBtn.onclick=()=>{let unique=[...new Map(mistakes.map(i=>[i.en,i])).values()];if(unique.length===0){alert('Ù…ÙÙŠØ´ ÙƒÙ„Ù…Ø§Øª ØºÙ„Ø· ğŸ‰');return;}words=unique.slice();current=0;mistakes=[];quizBlock.style.display='block';reviewBlock.style.display='none';showQuestion();feedbackEl.innerText='';}

/* ====== Speak Button ====== */
speakQuestionBtn.onclick=()=>{const q=words[current];if(!q)return;mode==='mc'?speak(q.en,'en'):speak(q.ar,'ar')}

/* ====== Initialize ====== */
originalWords=defaultWords.slice();
updateStars();
updateProgressBar(0,originalWords.length);
</script>
<script>
/* ====== Typing Mode Handler ====== */
typeInput.addEventListener('keydown', e=>{
  if(e.key==='Enter'){
    e.preventDefault();
    const val = typeInput.value.trim();
    if(!val) return;
    handleTyping(val);
  }
});

function handleTyping(val){
  const q = words[current];
  const correct = q.en.trim().toLowerCase();
  const given = val.trim().toLowerCase();
  
  if(given === correct){
    feedbackEl.innerText = msgsCorrect[Math.floor(Math.random()*msgsCorrect.length)];
    speak(q.en,'en');
    correctCount++;
    checkForStar();
  } else {
    feedbackEl.innerText = msgsWrong[Math.floor(Math.random()*msgsWrong.length)];
    speak(q.en,'en');
    mistakes.push(q);
  }
  
  typeInput.value = '';
  typeInput.blur();
  setTimeout(()=>{
    current++;
    feedbackEl.innerText='';
    showQuestion();
  },900);
}

/* ====== Multiple Choice Handler ====== */
function handleMCChoice(el, chosen, q){
  const options = Array.from(document.querySelectorAll('.option'));
  options.forEach(o => o.style.pointerEvents='none');
  
  if(chosen === q.ar){
    el.classList.add('correct');
    feedbackEl.innerText = msgsCorrect[Math.floor(Math.random()*msgsCorrect.length)];
    correctCount++;
    checkForStar();
    playCorrect();
  } else {
    el.classList.add('wrong');
    options.forEach(o => { if(o.textContent===q.ar) o.classList.add('correct'); });
    feedbackEl.innerText = msgsWrong[Math.floor(Math.random()*msgsWrong.length)];
    mistakes.push(q);
    playWrong();
  }
  
  setTimeout(()=>{
    if(chosen !== q.ar) speak(q.ar,'ar');
    current++;
    feedbackEl.innerText='';
    showQuestion();
  },900);
}

/* ====== Review List Play Buttons ====== */
function attachPlayButtons(){
  document.querySelectorAll('.play-icon').forEach(btn=>{
    btn.onclick=()=>{
      const lang=btn.dataset.lang;
      if(lang==='en') speak(btn.dataset.en,'en');
      else speak(btn.dataset.ar,'ar');
    }
  });
}

/* ====== Show Review ====== */
function showReview(){
  reviewBlock.style.display='block';
  const unique=dedupeKeepOrder(mistakes);
  
  if(unique.length===0){
    reviewList.innerHTML=`<div class="review-item" style="justify-content:center">Ø¨Ø±Ø§ÙÙˆ! Ù…ÙÙŠØ´ ÙˆÙ„Ø§ ØºÙ„Ø·Ø© ğŸ‘â¤ï¸</div>`;
    finalMsg.style.display='block';
    showSecretButton();
    spawnConfetti(120);
  } else {
    reviewList.innerHTML = unique.map(u=>`
      <div class="review-item">
        <div style="text-align:right">${u.en} â†’ <span class="mean">${u.ar}</span></div>
        <div>
          <button class="play-icon" data-lang="en" data-en="${u.en}" title="Ø§Ø³Ù…Ø¹ Ø§Ù„Ø§Ù†Ø¬Ù„ÙŠØ²ÙŠ">ğŸ”Š</button>
          <button class="play-icon" data-lang="ar" data-ar="${u.ar}" title="Ø§Ø³Ù…Ø¹ Ø§Ù„Ø¹Ø±Ø¨ÙŠ">ğŸ”ˆ</button>
        </div>
      </div>
    `).join('');
    attachPlayButtons();
    finalMsg.style.display='none';
  }
  retryBtn.style.display = unique.length>0?'inline-block':'none';
  saveState();
}

/* ====== Start Round ====== */
function beginRound(list){
  words = list.slice();
  current = 0;
  mistakes = [];
  correctCount=0;
  starsEarned=0;
  updateStars();
  
  modesSection.style.display='none';
  reviewBlock.style.display='none';
  finalMsg.style.display='none';
  quizBlock.style.display='block';
  typeArea.style.display = (mode==='type')?'block':'none';
  optionsEl.innerHTML='';
  feedbackEl.innerText='';
  updateProgressBar(current, words.length);
  showQuestion();
  saveState();
}

/* ====== Utility: Play Sounds (optional) ====== */
function playCorrect(){ /* Ù…Ù…ÙƒÙ† ØªØ¶ÙŠÙ ØµÙˆØª */ }
function playWrong(){ /* Ù…Ù…ÙƒÙ† ØªØ¶ÙŠÙ ØµÙˆØª */ }

/* ====== Speak TTS ====== */
function speak(text,langPref){
  if(!window.speechSynthesis) return;
  const utter=new SpeechSynthesisUtterance(text);
  const voices=window.speechSynthesis.getVoices();
  let voice=null;
  if(langPref==='en'){
    voice = voices.find(v=>/en-?/.test(v.lang)) || voices.find(v=>v.lang.startsWith('en')) || null;
    utter.lang = voice?voice.lang:'en-US';
  } else if(langPref==='ar'){
    voice = voices.find(v=>/ar-?/.test(v.lang)) || voices.find(v=>v.lang.startsWith('ar')) || null;
    utter.lang = voice?voice.lang:'ar-SA';
  }
  if(voice) utter.voice=voice;
  utter.rate=0.95; utter.pitch=1;
  window.speechSynthesis.cancel();
  window.speechSynthesis.speak(utter);
}

/* ====== Initialization ====== */
originalWords = defaultWords.slice();
updateStars();
updateProgressBar(0,originalWords.length);
</script>
